model=function(p)
{
P=NULL
for(i in 1:nrow(x))
{
theta=exp(p[1]+p[2]*x[i,1])/(1+exp(p[1]+p[2]*x[i,1]))
P[i]=dbinom(x[i,3],x[i,2],theta)
}
return(-sum(log(P))-
log(dnorm(p[1],mean=0,sd=sqrt(1000)))-
log(dnorm(p[2],mean=0,sd=sqrt(1000))))
}
a=nlm(model,p=c(0,1),hessian=TRUE)
a$estimate
a$estimate[1]-1.96*diag(solve(a$hessian))^.5
a$hessian
diag(solve(a$hessian))
a$estimate[1]-1.96*sqrt(diag(solve(a$hessian)))[1]
a$estimate[1]+(-1,1)*1.96*sqrt(diag(solve(a$hessian)))[1],
a$estimate[1]+(-1,1)*1.96*sqrt(diag(solve(a$hessian)))[1]
a$estimate[1]+c(-1,1)*1.96*sqrt(diag(solve(a$hessian)))[1]
a$estimate[2]+c(-1,1)*1.96*sqrt(diag(solve(a$hessian)))[2]
1385-568
0.760-0.213
f=function(p)  dbeta(p,569,818)
integrate(f,lower=0.213,upper=0.760)
# Checking the integral:
1-(pbeta(0.213,569,818)+(1-pbeta(0.760,569,818)))
2843.87-1757.46
setwd("/Users/Amanda/Dropbox/Thesis/Paper 5 -Under_extended/dades/dades_prova")
setwd("/Users/Amanda/Dropbox/Thesis/Paper 5 -Under_extended/dades/dades_prova")
1+0.642
r1=seq(0.01,0.99,0.05);length(r1)
r2=seq(0.01,0.99,0.05);length(r2)
om=seq(0.01,0.99,0.05);length(om)
q=seq(0.01,0.99,0.05);length(q)
mux=seq(0.5,20,0.5);length(mux)
20*20*20*40
r1=seq(0.01,0.99,0.05);length(r1)
r2=seq(0.01,0.99,0.05);length(r2)
om=seq(0.01,0.99,0.05);length(om)
q=seq(0.01,0.99,0.05);length(q)
mux=seq(0.5,20,0.5);length(mux)
res=matrix(NA,ncol=5,nrow=320001)
c=1
for(j in 1:length(r1))
{
for(k in 1:length(om))
{
for(z in 1:length(q))
{
for(m in 1:length(mux))
{
den=0;den=mux[m]*om[k]*(1-om[k])*(1-q[z])^2 + 1-om[k]*(1-q[z])
C1=0;C1=(1-om[k]*(1-q[z]))^2/den
C2=0;C2=om[k]*(1-om[k])*(1-q[z])^2/den
res[c,]=c(r1[j],om[k],q[z],mux[m],2*C1*C2*mux[m]-2*C1*r1[j])
c=c+1
print(c)
}
}
}
}
res
summary(res)
20^4*40
r1=seq(0.01,0.99,0.1);length(r1)
r2=seq(0.01,0.99,0.1);length(r2)
om=seq(0.01,0.99,0.1);length(om)
q=seq(0.01,0.99,0.1);length(q)
mux=seq(0.5,20,0.5);length(mux)
10^4*40
r1=seq(0.01,0.99,0.1);length(r1)
r2=seq(0.01,0.99,0.1);length(r2)
om=seq(0.01,0.99,0.1);length(om)
q=seq(0.01,0.99,0.1);length(q)
mux=seq(0.5,20,0.5);length(mux)
res=matrix(NA,ncol=5,nrow=4e+05)
c=1
for(i in 1:length(r1))
{
for(j in 1:length(r2))
{
for(k in 1:length(om))
{
for(z in 1:length(q))
{
for(m in 1:length(mux))
{
den=0;den=mux[m]*om[k]*(1-om[k])*(1-q[z])^2 + 1-om[k]*(1-q[z])
C1=0;C1=(1-om[k]*(1-q[z]))^2/den
C2=0;C2=om[k]*(1-om[k])*(1-q[z])^2/den
res[c,]=c(r1[i],r2[j],om[k],q[z],mux[m],C1*C2*mux[m]^2 - r2[j]*C2 + mux[m]*C1^2 + r1[i]^2)
c=c+1
print(c)
}
}
}
}
}
r1=seq(0.01,0.99,0.1);length(r1)
r2=seq(0.01,0.99,0.1);length(r2)
om=seq(0.01,0.99,0.1);length(om)
q=seq(0.01,0.99,0.1);length(q)
mux=seq(0.5,20,0.5);length(mux)
res=matrix(NA,ncol=6,nrow=4e+05)
c=1
for(i in 1:length(r1))
{
for(j in 1:length(r2))
{
for(k in 1:length(om))
{
for(z in 1:length(q))
{
for(m in 1:length(mux))
{
den=0;den=mux[m]*om[k]*(1-om[k])*(1-q[z])^2 + 1-om[k]*(1-q[z])
C1=0;C1=(1-om[k]*(1-q[z]))^2/den
C2=0;C2=om[k]*(1-om[k])*(1-q[z])^2/den
res[c,]=c(r1[i],r2[j],om[k],q[z],mux[m],C1*C2*mux[m]^2 - r2[j]*C2 + mux[m]*C1^2 + r1[i]^2)
c=c+1
print(c)
}
}
}
}
}
summary(res)
res
res[,6]<0
sum(res[,6]<0)
which(res[,6]<0)
res[which(res[,6]<0),]
r1=seq(0.01,0.99,0.1);length(r1)
r2=seq(0.01,0.99,0.1);length(r2)
om=seq(0.01,0.99,0.1);length(om)
q=seq(0.01,0.99,0.1);length(q)
mux=seq(0.5,20,0.5);length(mux)
res=matrix(NA,ncol=6,nrow=4e+05)
c=1
for(i in 1:length(r1))
{
for(j in 1:length(r2))
{
for(k in 1:length(om))
{
for(z in 1:length(q))
{
for(m in 1:length(mux))
{
den=0;den=mux[m]*om[k]*(1-om[k])*(1-q[z])^2 + 1-om[k]*(1-q[z])
C1=0;C1=(1-om[k]*(1-q[z]))^2/den
C2=0;C2=om[k]*(1-om[k])*(1-q[z])^2/den
res[c,]=c(r1[i],r2[j],om[k],q[z],mux[m],-r2[j]*C2*mux[m]^2 + mux[m]*r1[i]^2)
c=c+1
print(c)
}
}
}
}
}
summary(res)
res[which(res[,6]<0),]
summary(res)
# R interface to the C code for evaluating the negative log-likelihood
# of the INAR(1) model with generalized thinning operator (I3) and negative binomial innovations
# param=(alpha, p, theta, gamma)
# xdata = data vector
# iprint >=1 for printing of intermediate calculations
# Returns negative log-likelihood based on forward probabilities
setwd("/Users/Amanda/Dropbox/Thesis/Paper6-rPackage/ie2nb")
ie2nb.nllk=function(param,xdata,iprint=1)
{
if(any(param<=0)) return(1.e10)
if(param[1]>=1  ) return(1.e10)
if(!is.loaded("ie2nb")) dyn.load("./ie2nb.so")
n=length(xdata)
xdata=as.integer(xdata)
if(min(xdata)<0) stop("negative counts")
icode=3
nllk=0
out=.C("ie2nb", as.integer(n), as.integer(xdata),
as.double(param), as.integer(iprint),
as.integer(icode),nllk=as.double(nllk))
out$nllk
}
#======================================================================
xdata=c(1,3,0,4,6,7,8,3,3,4)
params=c(0.5,0.6,3,0.1)
res=ie2nb.nllk(param=params,xdata=xdata,iprint=1);res
setwd("/Users/Amanda/Dropbox/Thesis/Paper6-rPackage/ie2p")
ie2p.nllk=function(param,xdata,iprint=1)
{
if(any(param<=0)) return(1.e10)
if(param[1]>=1  ) return(1.e10)
if(!is.loaded("ie2p")) dyn.load("./ie2p.so")
n=length(xdata)
xdata=as.integer(xdata)
if(min(xdata)<0) stop("negative counts")
icode=3
nllk=0
out=.C("ie2p", as.integer(n), as.integer(xdata),
as.double(param), as.integer(iprint),
as.integer(icode),nllk=as.double(nllk))
out$nllk
}
xdata=c(1,3,0,4,6,7,8,3,3,4)
params=c(0.5,0.6,3,0.1)
res=ie2p.nllk(param=params,xdata=xdata,iprint=1);res
setwd("/Users/Amanda/Dropbox/Thesis/Paper6-rPackage/ie2p")
ie2p.nllk=function(param,xdata,iprint=1)
{
if(any(param<=0)) return(1.e10)
if(param[1]>=1  ) return(1.e10)
if(!is.loaded("ie2p")) dyn.load("./ie2p.so")
n=length(xdata)
xdata=as.integer(xdata)
if(min(xdata)<0) stop("negative counts")
icode=3
nllk=0
out=.C("ie2p", as.integer(n), as.integer(xdata),
as.double(param), as.integer(iprint),
as.integer(icode),nllk=as.double(nllk))
out$nllk
}
xdata=c(1,3,0,4,6,7,8,3,3,4)
params=c(0.5,0.6,3,0.1)
res=ie2p.nllk(param=params,xdata=xdata,iprint=1);res
setwd("/Users/Amanda/Dropbox/Thesis/Paper6-rPackage/ie2p")
ie2p.nllk=function(param,xdata,iprint=1)
{
if(any(param<=0)) return(1.e10)
if(param[1]>=1  ) return(1.e10)
if(!is.loaded("ie2p")) dyn.load("./ie2p.so")
n=length(xdata)
xdata=as.integer(xdata)
if(min(xdata)<0) stop("negative counts")
icode=3
nllk=0
out=.C("ie2p", as.integer(n), as.integer(xdata),
as.double(param), as.integer(iprint),
as.integer(icode),nllk=as.double(nllk))
out$nllk
}
#======================================================================
xdata=c(1,3,0,4,6,7,8,3,3,4)
params=c(0.5,0.6,3,0.1)
res=ie2p.nllk(param=params,xdata=xdata,iprint=1);res
setwd("/Users/Amanda/Dropbox/Thesis/Paper6-rPackage/ITPNB")
ie2p.nllk=function(param,xdata,iprint=1)
{
if(any(param<=0)) return(1.e10)
if(param[1]>=1  ) return(1.e10)
if(!is.loaded("ie2p")) dyn.load("./ie2p.so")
n=length(xdata)
xdata=as.integer(xdata)
if(min(xdata)<0) stop("negative counts")
icode=3
nllk=0
out=.C("ie2p", as.integer(n), as.integer(xdata),
as.double(param), as.integer(iprint),
as.integer(icode),nllk=as.double(nllk))
out$nllk
}
#======================================================================
xdata=c(1,3,0,4,6,7,8,3,3,4)
params=c(0.5,0.6,3,0.1)
res=ie2p.nllk(param=params,xdata=xdata,iprint=1);res
setwd("/Users/Amanda/Dropbox/Thesis/Paper6-rPackage/itpnb")
ie2p.nllk=function(param,xdata,iprint=1)
{
if(any(param<=0)) return(1.e10)
if(param[1]>=1  ) return(1.e10)
if(!is.loaded("ie2p")) dyn.load("./ie2p.so")
n=length(xdata)
xdata=as.integer(xdata)
if(min(xdata)<0) stop("negative counts")
icode=3
nllk=0
out=.C("ie2p", as.integer(n), as.integer(xdata),
as.double(param), as.integer(iprint),
as.integer(icode),nllk=as.double(nllk))
out$nllk
}
#======================================================================
xdata=c(1,3,0,4,6,7,8,3,3,4)
params=c(0.5,0.6,3,0.1)
res=ie2p.nllk(param=params,xdata=xdata,iprint=1);res
setwd("/Users/Amanda/Dropbox/Thesis/Paper6-rPackage/itpnb")
ie2nb.nllk=function(param,xdata,iprint=1)
{
if(any(param<=0)) return(1.e10)
if(param[1]>=1  ) return(1.e10)
if(!is.loaded("ie2nb")) dyn.load("./ie2nb.so")
n=length(xdata)
xdata=as.integer(xdata)
if(min(xdata)<0) stop("negative counts")
icode=3
nllk=0
out=.C("ie2nb", as.integer(n), as.integer(xdata),
as.double(param), as.integer(iprint),
as.integer(icode),nllk=as.double(nllk))
out$nllk
}
#======================================================================
xdata=c(1,3,0,4,6,7,8,3,3,4)
params=c(0.5,0.6,3,0.1)
res=ie2nb.nllk(param=params,xdata=xdata,iprint=1);res
setwd("/Users/Amanda/Dropbox/Thesis/Paper6-rPackage/itpnb")
ie1nb.nllk=function(param,xdata,iprint=1)
{
if(any(param<=0)) return(1.e10)
if(param[1]>=1  ) return(1.e10)
if(!is.loaded("ie1nb")) dyn.load("./ie1nb.so")
n=length(xdata)
xdata=as.integer(xdata)
if(min(xdata)<0) stop("negative counts")
icode=2
nllk=0
out=.C("ie1nb", as.integer(n), as.integer(xdata),
as.double(param), as.integer(iprint),
as.integer(icode),nllk=as.double(nllk))
out$nllk
}
#======================================================================
xdata=c(1,3,0,4,6,7,8,3,3,4)
params=c(0.5,0.6,3,0.1)
res=ie1nb.nllk(param=params,xdata=xdata,iprint=2);res
setwd("/Users/Amanda/Dropbox/Thesis/Paper6-rPackage/itpnb")
ie1p.nllk=function(param,xdata,iprint=1)
{
if(any(param<=0)) return(1.e10)
if(param[1]>=1  ) return(1.e10)
if(!is.loaded("ie1p")) dyn.load("./ie1p.so")
n=length(xdata)
xdata=as.integer(xdata)
if(min(xdata)<0) stop("negative counts")
icode=2
nllk=0
out=.C("ie1p", as.integer(n), as.integer(xdata),
as.double(param), as.integer(iprint),
as.integer(icode),nllk=as.double(nllk))
out$nllk
}
#======================================================================
xdata=c(1,3,0,4,6,7,8,3,3,4)
params=c(0.5,0.6,3)
res=ie1p.nllk(param=params,xdata=xdata,iprint=2); res
setwd("/Users/Amanda/Dropbox/Thesis/Paper6-rPackage/itpnb")
ibp.nllk=function(param,xdata,iprint=1)
{
if(any(param<=0)) return(1.e10);
if(param[1]>=1  ) return(1.e10)
if(!is.loaded("ibp")) dyn.load("./ibp.so")
n=length(xdata)
xdata=as.integer(xdata)
if(min(xdata)<0) stop("negative counts")
nllk=0
out=.C("ibp", as.integer(n), as.integer(xdata),
as.double(param), as.integer(iprint),
nllk=as.double(nllk))
out$nllk
}
#======================================================================
xdata=c(1,3,0,4,6,7,8,3,3,4)
params=c(0.5,3)
res=ibp.nllk(param=params,xdata=xdata,iprint=2); res
setwd("/Users/Amanda/Dropbox/Thesis/Paper6-rPackage/itpnb")
ibp.nllk=function(param,xdata,iprint=1)
{
if(any(param<=0)) return(1.e10);
if(param[1]>=1  ) return(1.e10)
if(!is.loaded("ibp")) dyn.load("./ibp.so")
n=length(xdata)
xdata=as.integer(xdata)
if(min(xdata)<0) stop("negative counts")
nllk=0
out=.C("ibp", as.integer(n), as.integer(xdata),
as.double(param), as.integer(iprint),
nllk=as.double(nllk))
out$nllk
}
#======================================================================
xdata=c(1,3,0,4,6,7,8,3,3,4)
params=c(0.5,3)
res=ibp.nllk(param=params,xdata=xdata,iprint=2); res
t.probs=function(data,par)
{kk=0:min(data[1],data[2])
sum(dbinom(kk,data[1],par[1])*dpois(data[2]-kk,par[2]))
}
LF=function(p,y) return(-log(dpois(y[1],p[2]/(1-p[1])))-sum(log(apply(cbind(y[-10],y[-1]),1,t.probs,par=p))))
system.time(nlm(LF,p=p.ini,y=x.sim))
p.ini=c(0.5,3)
y=c(1,3,0,4,6,7,8,3,3,4)
p.ini=c(0.5,3)
LF=function(p,y) return(-log(dpois(y[1],p[2]/(1-p[1])))-sum(log(apply(cbind(y[-10],y[-1]),1,t.probs,par=p))))
system.time(nlm(LF,p=p.ini,y=x.sim))
nlm(LF,p=p.ini,y=y)
-log(dpois(y[1],p[2]/(1-p[1])))-sum(log(apply(cbind(y[-10],y[-1]),1,t.probs,par=p)))
y=c(1,3,0,4,6,7,8,3,3,4)
p=c(0.5,3)
-log(dpois(y[1],p[2]/(1-p[1])))-sum(log(apply(cbind(y[-10],y[-1]),1,t.probs,par=p)))
-sum(log(apply(cbind(y[-10],y[-1]),1,t.probs,par=p)))
y=c(1,3,0,4,6,7,8,3,3,4)
p=c(0.5,0.6)
-log(dpois(y[1],p[2]/(1-p[1])))
-sum(log(apply(cbind(y[-10],y[-1]),1,t.probs,par=p)))
y=c(1,3,0,4,6,7,8,3,3,4)
p=c(0.5,3)
-sum(log(apply(cbind(y[-10],y[-1]),1,t.probs,par=p)))
setwd("/Users/Amanda/Dropbox/Thesis/Paper6-rPackage/itpnb")
ibp.nllk=function(param,xdata,iprint=1)
{
if(any(param<=0)) return(1.e10);
if(param[1]>=1  ) return(1.e10)
if(!is.loaded("ibp")) dyn.load("./ibp.so")
n=length(xdata)
xdata=as.integer(xdata)
if(min(xdata)<0) stop("negative counts")
nllk=0
out=.C("ibp", as.integer(n), as.integer(xdata),
as.double(param), as.integer(iprint),
nllk=as.double(nllk))
out$nllk
}
#======================================================================
xdata=c(1,3,0,4,6,7,8,3,3,4)
params=c(0.5,3)
res=ibp.nllk(param=params,xdata=xdata,iprint=2); res
setwd("/Users/Amanda/Dropbox/Thesis/Paper6-rPackage/itpnb")
ibp.nllk=function(param,xdata,iprint=1)
{
if(any(param<0)) return(1.e10);
if(param[1]>=1  ) return(1.e10)
if(!is.loaded("ibp")) dyn.load("./ibp.so")
n=length(xdata)
xdata=as.integer(xdata)
if(min(xdata)<0) stop("negative counts")
nllk=0
out=.C("ibp", as.integer(n), as.integer(xdata),
as.double(param), as.integer(iprint),as.integer(icode),
nllk=as.double(nllk))
out$nllk
}
#======================================================================
xdata=c(1,3,0,4,6,7,8,3,3,4)
params=c(0.5,3,0)
res=ibp.nllk(param=params,xdata=xdata,iprint=2); res
setwd("/Users/Amanda/Dropbox/Thesis/Paper6-rPackage/itpnb")
ibp.nllk=function(param,xdata,iprint=1)
{
if(any(param<0)) return(1.e10);
if(param[1]>=1  ) return(1.e10)
if(!is.loaded("ibp")) dyn.load("./ibp.so")
n=length(xdata)
xdata=as.integer(xdata)
if(min(xdata)<0) stop("negative counts")
nllk=0
icode=1
out=.C("ibp", as.integer(n), as.integer(xdata),
as.double(param), as.integer(iprint),as.integer(icode),
nllk=as.double(nllk))
out$nllk
}
#======================================================================
xdata=c(1,3,0,4,6,7,8,3,3,4)
params=c(0.5,3,0)
res=ibp.nllk(param=params,xdata=xdata,iprint=2); res
# param=(alpha, lambda)
# xdata = data vector
# iprint >=1 for printing of intermediate calculations
# Returns negative log-likelihood based on forward probabilities
setwd("/Users/Amanda/Dropbox/Thesis/Paper6-rPackage/itpnb")
ibp.nllk=function(param,xdata,iprint=1)
{
if(any(param<0)) return(1.e10);
if(param[1]>=1  ) return(1.e10)
if(!is.loaded("ibp")) dyn.load("./ibp.so")
n=length(xdata)
xdata=as.integer(xdata)
if(min(xdata)<0) stop("negative counts")
nllk=0
icode=1
out=.C("ibp", as.integer(n), as.integer(xdata),
as.double(param), as.integer(iprint),as.integer(icode),
nllk=as.double(nllk))
out$nllk
}
#======================================================================
xdata=c(1,3,0,4,6,7,8,3,3,4)
params=c(0.5,9)
res=ibp.nllk(param=params,xdata=xdata,iprint=2); res
setwd("/Users/Amanda/Dropbox/Thesis/Paper6-rPackage/ibnb")
ibp.nllk=function(param,xdata,iprint=1)
{
if(any(param<0)) return(1.e10);
if(param[1]>=1  ) return(1.e10)
if(!is.loaded("ibnb")) dyn.load("./ibnb.so")
n=length(xdata)
xdata=as.integer(xdata)
if(min(xdata)<0) stop("negative counts")
nllk=0
icode=1
out=.C("ibnb", as.integer(n), as.integer(xdata),
as.double(param), as.integer(iprint),as.integer(icode),
nllk=as.double(nllk))
out$nllk
}
xdata=c(1,3,0,4,6,7,8,3,3,4)
params=c(0.5,0.3,9)
res=ibp.nllk(param=params,xdata=xdata,iprint=2); res
